# Race Condition Exploit Script

This python script is used to exploit a race condition web vulnerability, as part of the Racetrack Bank TryHackMe (THM) room.

## What is a Race Condition?

A race condition is an undesirable situation that occurs when a device or system attempts to perform two or more operations at the same time, but because of the nature of the device or system, the operations must be done in the proper sequence to be done correctly.

A race condition occurs when two or more threads can access shared data and they try to change it at the same time. Because the thread scheduling algorithm can swap between threads at any time, you don’t know the order in which the threads will attempt to access the shared data. Therefore, the result of the change in data is dependent on the thread scheduling algorithm, i.e. both threads are “racing” to access/change the data.

## Racetrack Bank TryHackMe (THM) Overview

The main features of the Racetrack Bank website include:

* Create an Account
* Login Page
* Dashboard/Home page
* Purchase Page
* Give Gold to other users

The Racetrack Bank website also requires **10,000 gold** to access the premium features. 

After performing some enmeration, it was discovered that the website was powered by **Express Node.js Framework** and was using a node.js package called **racetrack**. 

The description for the racetrack node.js package is provided below:

```
Racetrack is a way to make sure that all your async calls are completed, and to find out where they went wrong if any of them are not completed.

It’s meant to be easy to drop in for classes that have a bunch of methods whose last parameter are all a function. Otherwise you’ll have to preface each function with a trace hook.

It’s still pretty raw.
```

Reading the description of the package, it indicates that a race condition attack may be possible since the package uses asynchronous calls.

## How does the Race Condition Exploit Script Work?

We know that to access the premium features, 10,000 gold is required. We also know that the website allows one user to give gold to another user, which is where the race condition was found and exploited.

This script is used to send gold from one user’s account to another user’s account on the Racetrack Bank Website. It exploits the race condition vulnerability, whereby instead of sending one POST request at a time and waiting for a response (i.e. Synchronous), multiple POST requests are sent at the same time (Asynchronous). These requests are all handled individually before a response to the first request can be sent back, resulting in multiple requests being processed and gold being sent to the users.

**Script Usage Instructions**:

1. Make sure two separate accounts have been created on the website and the credentials have been specified in the script below.
2. Make sure both users have at least one gold in their account.

**N.B.** Make sure the IP address set is correct. Also, the cookie changes for a user each time you login or out which is handled by the script below.

This script can take a few minutes to run but will eventually give us the gold we need to buy the premium features.